@model Pitstop.WebApp.ViewModels.RepairManagementNewViewModel
@{
    ViewData["Title"] = "Create Repair Order";
}
<h3 id="PageTitle">Repair Management - New Repair Order</h3>

<h2>New Repair Order</h2>
<form asp-controller="RepairManagement" asp-action="CreateRepairOrder" method="post">
    <div class="form-group">
        <label>Customer Name</label>
        <input asp-for="CustomerName" class="form-control" readonly/>
    </div>

    <div class="form-group">
        <label>License Number</label>
        <input asp-for="LicenseNumber" class="form-control" readonly/>
    </div>

    <div class="form-group">
        <label>Select Vehicle Parts</label>
        <div class="row">
            @for (int i = 0; i < Model.AvailableVehicleParts.Count; i += 2)
            {
                <div class="col-md-6">
                    <div class="form-check">
                        <input type="checkbox" name="SelectedVehicleParts" class="form-check-input vehicle-part-checkbox" value="@Model.AvailableVehicleParts[i].Id" data-cost="@Model.AvailableVehicleParts[i].Cost"/>
                        <label class="form-check-label">
                            @Model.AvailableVehicleParts[i].Name - @Model.AvailableVehicleParts[i].Cost.ToString("C", new System.Globalization.CultureInfo("en-US"))
                        </label>
                    </div>

                    @if (i + 1 < Model.AvailableVehicleParts.Count)
                    {
                        <div class="form-check">
                            <input type="checkbox" name="SelectedVehicleParts" class="form-check-input vehicle-part-checkbox" value="@Model.AvailableVehicleParts[i + 1].Id" data-cost="@Model.AvailableVehicleParts[i + 1].Cost"/>
                            <label class="form-check-label">
                                @Model.AvailableVehicleParts[i + 1].Name - @Model.AvailableVehicleParts[i + 1].Cost.ToString("C", new System.Globalization.CultureInfo("en-US"))
                            </label>
                        </div>
                    }
                </div>
            }
        </div>
    </div>

    <div class="form-group">
        <label asp-for="LaborCost">Labor Cost</label>
        <input asp-for="LaborCost" class="form-control labor-cost-input"/>
        <span asp-validation-for="LaborCost" class="text-danger"></span>
    </div>

    <div class="form-group text-right">
        <label>Total Cost: <span id="total-cost">â‚¬0.00</span></label>
        <input asp-for="TotalCost" type="hidden" readonly/>
    </div>

    <button type="submit" class="btn btn-primary">Create Repair Order</button>
</form>

@section Scripts {
    @{ await Html.RenderPartialAsync("_ValidationScriptsPartial"); }
    <script>
    function calculateTotalCost() {
        let totalCost = 0;

        document.querySelectorAll('.vehicle-part-checkbox:checked').forEach(function(checkbox) {
            totalCost += parseFloat(checkbox.getAttribute('data-cost'));
        });

        const laborCost = parseFloat(document.querySelector('.labor-cost-input').value) || 0;
        totalCost += laborCost;

        document.getElementById('total-cost').innerText = totalCost.toLocaleString('en-US', {
            style: 'currency',
            currency: 'USD'
        });

        document.querySelector('input[name="TotalCost"]').value = totalCost;
    }

    document.querySelectorAll('.vehicle-part-checkbox').forEach(function(checkbox) {
        checkbox.addEventListener('change', calculateTotalCost);
    });

    document.querySelector('.labor-cost-input').addEventListener('input', calculateTotalCost);

    document.querySelectorAll('.vehicle-part-checkbox').forEach(function(checkbox) {
        checkbox.addEventListener('change', function(event) {

            calculateTotalCost();
        });
    });
</script>
}